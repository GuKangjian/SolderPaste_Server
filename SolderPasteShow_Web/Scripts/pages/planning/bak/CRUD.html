<!doctype html>
<html style="height:100%;font-size:14px;">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="https://cdn.grapecity.com/spreadjs/hosted/css/gc.spread.views.dataview.11.0.0.css">
    <link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/pageui.css">
    <script src="../../plugins/jQuery/jquery-2.2.3.min.js"></script>
    <script src="../../plugins/SpreadJS/Spread.Views/common/gc.spread.common.11.0.0.min.js" type="text/javascript"></script>
    <script src="../../plugins/SpreadJS/Spread.Views/gc.spread.views.dataview.11.0.0.min.js" type="text/javascript"></script>
    <script src="../../plugins/SpreadJS/Spread.Views/plugins/gc.spread.views.gridlayout.11.0.0.min.js" type="text/javascript"></script>
    <script src="http://echarts.baidu.com/build/dist/echarts-all.js" type="text/javascript"></script>

    <script src="../../plugins/SpreadJS/Spread.Views/plugins/gc.spread.views.paging.11.0.0.min.js" type="text/javascript"></script>
    <script src="js/zepto.min.js" type="text/javascript"></script>
    <script src="js/lodash.min.js" type="text/javascript"></script>
    <script src="js/pageui.js" type="text/javascript"></script>
    <script src="js/license.js" type="text/javascript"></script>
    <style>
        * {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }
        
        .gc-action-area {
            text-align: center;
        }
        
        .gc-header-row-cell {
            background-color: #eaeaea;
        }
        
        #btnAddNew {
            margin: 5px;
            border-radius: 5px;
        }
        
        .add-icon {
            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAB3RJTUUH3QsJATErA49PDwAAAgBJREFUOMut1T1IVWEYB/DfPfdKXxTRkFFD0KUhDUIotEYHl0KkoKlF+qBIoqGGloZoq6EPpaAiCGmIDDVaa4sgSYSyaIiiEEkSK4REr7flOXA63NsH9MCBw/s+z//5/r+Fjo4ONWQrdmMvmlGN8wJe4QEe4WXesJADXImTOI05PMczTMf9GrRhB5bgAi7hewpQyoCtQy/24V4oj6gt28PpOWxDDyazgKvRhz04hluYV19GcABPcDlKcRAzKWBP1Oswbvo7mcd1LOAGRnG+WC6Xm3EH93E204BUVmEX1mMqALIyhs04hKEEneHtIio1ItmCAdzG2hr3lbCdR2eCLjyNkOulVox6/6ijMxoYXQmaYjSyqa7AJjRGqgUk2IgN8TVk9KuB0VQKxS85j+3RnG9YHg6WRepVfEI33mZsppEkoVDxn6QUgI2588fYidnYiruRxX5MhM7nnM0aLJYwjtaoU1rHWbyL/4k4X8SHGkDpjrdhPMFgzFlLnSwaoiQLWFpHpyUwBhMMh9GpGI+8vI797q4TXTFsGzBcLJfLU9HpE/iIFzmDObyPu4UagEdwJohiIN3l3gi7Lxr1J3JIS3E0yGEAV0VkMIPjeIhr6A+K8hv66seV4IAefM3z4WTUaSy4rj1HsJXY5dYYpWKQyS8EW/iHJ6AaGaVPwBDe5A1/AgojgwuRXC6BAAAAAElFTkSuQmCC);
            background-repeat: no-repeat;
            cursor: pointer;
            color: transparent;
            height: 20px;
            width: 20px;
            margin-right: 5px;
            padding: 0;
            border: none;
        }
        
        .edit-icon {
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAVJJREFUOBGV0ksrRGEcx/FjhmJBLGyUCElRyuUNaIp4B1ayUd6AjbLxjixtZBALElGuRQmRSwkpl+/3zDmTOcYY//qcy3P5nfM85wRBEKRgdWEaDd5QcXvu7o9jL/2v+MQeamGVHTLLYCffROdFzlZFJLwpdWih8w6GnCEDl1MJy6CilabVQffYQjtmMI9n9GMZLsXwH2XABzwfw1cfwwjasI8erMMHObagnGiZ7lMeMYhNDKMet2jEDqpQEBIH0J6vNa4yWME4DK3BG05QEJIMiNeaZeAoljCJA3TgHFdwXrgnyQAbbXvHNoawgSmsYgCH8IuFXyYZQHuY7IY9wSf24QiGuKkv8GcL36JYAH3hRrnWa/iHNkVtbmQ1mrGL9G8B9OVDTrn2186iE3N4wAJKzac7Vy7H6oZLcp8ukELZFYc4YQKXcIP/Vd+fWMfMVmd/AZ8ZSPZy3VL5AAAAAElFTkSuQmCC');
        }
        
        .save-icon {
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAUUlEQVQ4T2NkYGD4z0AeWMDAwJDISIEBIGsXIBuAyzCQOAjAXAriJzAwMMwHCZJrANzAoWEAehyhhAm6F0iJUHCgjhow2MKAlCiEq6U0NzIAAGhyJqIFiXmZAAAAAElFTkSuQmCC');
        }
        
        .cancel-icon {
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAv0lEQVQ4T6WT7RHBQBRFTyqgA3RAB0rQASoQHShBOtAJKpASlKAD5mR2Z3YIJrvvV5K3e+59H6kojAo4AZuEMwV2wBKYh+8tcAEa4J5qCngGyBY4hsu/fHlmHw9EgO8PYBwSKulMZUMnNbBOHC18TgERaiJefHciyFJGoZy6D6Cy5XwLIbeQnPUBzP2DmLecRkBORBdtLkBRp9c1MTeKAC7ZGbjmOogLl9XEjzEO7YH/wiRdpKEAHRyAVekUOuEXS4Mk/lKeo50AAAAASUVORK5CYII=');
        }
        
        .action-btn {
            display: inline-block;
            height: 100%;
            border: none;
            background-color: transparent;
            outline: none;
        }
        
        .action-btn span {
            display: block;
            width: 16px;
            height: 16px;
        }
        
        #btnAddNew span {
            display: inline-block;
            vertical-align: middle;
        }
        
        .gc-row {
            line-height: 36px;
        }
        
        .page-part-left {
            vertical-align: middle;
            display: inline-block;
            margin-left: 6px;
        }
        
        .page-part-right {
            vertical-align: middle;
            display: inline-block;
            margin: 3px 6px;
            float: right;
        }
        
        .button {
            padding: 6px 12px;
            border: 1px solid transparent;
            border-radius: 4px;
            transition: background-color 0.5s cubic-bezier(0.22, 0.61, 0.36, 1);
            color: #000000;
        }
        
        .button:not(.intangible):hover {
            background-color: #d7d7d7;
        }
        
        .content {
            padding: 6px 6px;
        }
        
        .content input {
            width: 28px;
            font-size: 15px;
        }
        
        .divider {
            height: 20px;
            width: 0;
            border-left: 1px solid #c2c2c2;
        }
        
        .intangible {
            cursor: inherit;
            opacity: 0.3;
            -moz-user-select: none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .container {
            box-sizing: border-box;
            border: solid rgba(0, 0, 0, 0.2);
            border-width: 0 1px 1px 1px;
            padding: 3px 0;
            text-align: left;
            height: 42px;
            width: 100%;
            font-size: 16px;
        }
    </style>
</head>

<body style="margin:0 0 0 0;position:absolute;top:0;bottom:0;left:0;right:0;font-size:14px;user-select:none;-webkit-user-select: none;overflow:hidden;">
    <div id="grid1" style="height:402px;outline:none">
    </div>
    <div id="page-nav" class="container">
    </div>
    <div style="display: none;">
        <span id="loadFailed">从远程服务器获取数据失败。</span>
        <span id="addFailed">向远程服务器添加数据数败。</span>
        <span id="deleteFailed">删除远程服务器数据失败。</span>
        <span id="updateFailed">更新远程服务器数据失败。</span>
        <span id="addNew"> 添加新数据</span>
    </div>
    <script type="text/javascript">
        var loadFailedStr = document.getElementById('loadFailed').innerText;
        var addFailedStr = document.getElementById('addFailed').innerText;
        var deleteFailedStr = document.getElementById('deleteFailed').innerText;
        var updateFailedStr = document.getElementById('updateFailed').innerText;
        var addNewStr = document.getElementById('addNew').innerText;

        var columns = [{
            id: 'editCol',
            width: 70,
            action: [{
                name: 'edit',
                presenter: '<button class="edit-btn action-btn" data-action="edit"><span class="edit-icon"></span></button>'
            }]
        }, {
            id: 'id',
            caption: 'Order Id',
            dataField: 'Transaction_Id',
            dataType: 'number',
            allowEditing: false,
            width: 80
        }, {
            id: 'product',
            caption: 'Product',
            dataField: 'Product',
            width: 300
        }, {
            id: 'price',
            caption: 'Item Price',
            dataField: 'Price',
            dataType: 'number',
            width: '*'
        }, {
            id: 'quantity',
            caption: 'Quantity',
            dataField: 'Quantity',
            dataType: 'number',
            width: '*'
        }, {
            id: 'name',
            caption: 'Name',
            dataField: 'Name',
            width: '*'
        }, {
            id: 'country',
            caption: 'Country',
            dataField: 'Country',
            width: '*'
        }, {
            id: 'detail',
            caption: 'Detail',
            dataField: 'Product_Detail',
            width: '*'
        }, {
            id: 'deleteCol',
            width: 50,
            action: [{
                name: 'delete',
                presenter: '<button class="delete-btn action-btn" data-action="delete"><span>✖</span></button>',
                handler: deleteItem
            }]
        }];

        var dataView;
        var currentPageDataSource;
        var itemsTotalCount;
        var baseUrl = '//spread.grapecity.com/remotedata/api/records';
        var dataSource = {
            loadRange: function(params) {
                $.ajax({
                    //pageSize and startPageIndex only works when paging component is referenced, if control
                    //do find the paging component, pageSize and pageIndex will be undefined.
                    url: getRecords(params.pageIndex == undefined ? undefined : (params.pageSize * params.pageIndex), params.pageSize),
                    crossDomain: true,
                    success: function(result) {
                        currentPageDataSource = result.m_Item2;
                        itemsTotalCount = result.m_Item1;
                        params.success(currentPageDataSource, itemsTotalCount);
                    },
                    error: function(xhr, status) {
                        params.failed();
                        if (status !== 'abort') {
                            alert(loadFailedStr);
                        }
                    }
                });
            },
            create: function(params) {
                var dataItem = _.clone(params.dataItem);
                $.ajax({
                    url: baseUrl,
                    type: 'POST',
                    data: JSON.stringify(dataItem),
                    success: function(data) {
                        dataItem['Transaction_Id'] = data['Transaction_Id'];
                        params.success(dataItem);
                    },
                    error: function(xhr, status) {
                        params.failed();
                        alert(addFailedStr);
                    }
                });
            },
            delete: function(params) {
                $.ajax({
                    url: baseUrl + '/' + params.dataItem['Transaction_Id'],
                    type: 'DELETE',
                    success: function(data) {
                        params.success();
                    },
                    error: function(xhr, status) {
                        params.failed();
                        alert(deleteFailedStr);
                    }
                });
            },
            update: function(params) {
                $.ajax({
                    url: baseUrl + '/' + params.dataItem['Transaction_Id'],
                    type: 'PUT',
                    data: JSON.stringify(params.dataItem),
                    success: function(data) {
                        params.success();
                    },
                    error: function(xhr, status) {
                        params.failed();
                        alert(updateFailedStr);
                    }
                });
            }
        };
        $(document).ready(function() {
            dataView = new GC.Spread.Views.DataView(document.getElementById('grid1'), dataSource, columns, new GC.Spread.Views.Plugins.GridLayout({
                colWidth: 80,
                showColHeader: false,
                showRowHeader: false,
                rowHeight: 36,
                pageSize: 10,
                allowEditing: true,
                editMode: 'popup',
                autoAddRowPosition: 'top',
                headerRow: {
                    visible: true,
                    height: 40,
                    separateColumn: false,
                    renderer: '<button id="btnAddNew"><span class="add-icon"></span><span>' + addNewStr + '</span></button>'
                }
            }));

            dataView.editing.addHandler(function(sender, args) {
                if (args.status === 'endEditing' && args.isNewRow || args.status === 'cancelEditing') {
                    if (dataView.options.allowAutoAddRow) {
                        dataView.options.allowAutoAddRow = false;
                        dataView.invalidate();
                    }
                }
            });

            $('#btnAddNew').on('click', function() {
                var addNewRecordID = dataView.uid + '-autorow';
                dataView.startEditing(addNewRecordID);
            });

            var pageController = dataView.data.pageController;
            var pager = new PageUI('#page-nav', pageController.getStatus());

            pager.goToFirstEvent.addHandler(function() {
                pageController.first();
            });

            pager.goToPreviousEvent.addHandler(function() {
                pageController.previous();
            });

            pager.goToNextEvent.addHandler(function() {
                pageController.next();
            });

            pager.goToLastEvent.addHandler(function() {
                pageController.last();
            });

            pager.goToPageEvent.addHandler(function(e) {
                pageController.goToPage(e.newPage);
            });

            pageController.statusChanged.addHandler(function(sender, newStatus) {
                pager.updateStatus(newStatus);
            });
        });

        //action column handler
        function deleteItem(args) {
            var rowId = dataView.getRowId(args.hitInfo);
            var dataItem = dataView.getItem(rowId);
            if (dataItem && dataItem.item) {
                var sourceIndex = dataItem.item.sourceIndex;
                if (sourceIndex >= 0) {
                    dataView.data.removeDataItems(sourceIndex);
                }
            }
        }

        function getRecords(start, count) {
            var result = [];
            if (start != undefined) {
                result.push('start=' + start);
            }
            if (count != undefined) {
                result.push('count=' + count);
            }

            if (result.length > 0) {
                return baseUrl + '?' + result.join('&');
            }
            return baseUrl;
        }
    </script>
</body>

</html>